<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>パズルゲーム ホーム</title>
  <style>
    body {
      background-color: #e0f7fa; /* 全体の背景色：薄い水色 */
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
    }
    .screen { 
      display: none; 
    }
    .visible { 
      display: block; 
    }
    /* ホーム画面全体 */
    #home-screen {
      max-width: 700px;
      margin: 0 auto;
    }
    #home-screen h1 {
      text-align: center;
      margin-bottom: 20px;
    }
    /* ゲーム一覧のレイアウト */
    .game-list {
      margin-top: 20px;
    }
    .game-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-radius: 5px;
      padding: 15px;
      margin-bottom: 15px;
      box-shadow: 0px 2px 4px rgba(0,0,0,0.1);
      /* 固定の高さを設定して、項目の大きさを揃える */
      min-height: 80px;
    }
    /* 個別の背景色（薄い色） */
    .game-15puzzle {
      background-color: #f0f8ff; /* AliceBlue */
    }
    .game-xx {
      background-color: #fff9c4; /* 薄い黄色 */
    }
    .game-△△ {
      background-color: #e1f5fe; /* 薄い青 */
    }
    .game-title {
      font-weight: bold;
      font-size: 18px;
      flex: 1;
    }
    /* 難易度選択ボタン群 */
    .game-difficulty button {
      margin-left: 5px;
      padding: 8px 12px;
      font-size: 14px;
      border: none;
      border-radius: 5px;
      background-color: #4CAF50;
      color: white;
      cursor: pointer;
    }
    .game-difficulty button:hover {
      background-color: #45a049;
    }
    /* UNDER CONSTRUCTION 表示 */
    .under-construction {
      font-size: 20px;
      color: #555;
      font-weight: bold;
      text-align: center;
      flex: 1;
    }
    /* ログアウトボタン */
    .logout-btn {
      display: block;
      margin: 20px auto 0;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      background-color: #f44336;
      color: white;
      cursor: pointer;
    }
    .logout-btn:hover {
      background-color: #d32f2f;
    }
    /* ゲーム画面（15パズル用）のスタイル（以下は以前の設定を維持） */
    .tile {
      width: 100px;
      height: 100px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      border: 1px solid #ccc;
      cursor: pointer;
      background-color: #87CEEB;
      font-weight: bold;
      color: #FFFFFF;
      border-radius: 8px;
      position: absolute;
      transition: transform 0.3s ease-in-out;
    }
    .tile.empty { 
      background-color: transparent; 
      cursor: default; 
    }
    .timer {
      margin-bottom: 10px; 
      font-size: 18px;
    }
    .grid {
      position: relative;
      display: grid;
      gap: 5px;
      margin-top: 20px;
      padding: 10px;
    }
    button {
      margin: 5px;
    }
    .author {
      margin-top: 20px;
      font-size: small;
      color: gray;
    }
  </style>
</head>
<body onload="showScreen('login-screen')">

  <!-- ログイン画面 -->
  <div id="login-screen" class="screen visible">
    <h2>ログイン</h2>
    <input id="username" type="text" placeholder="ユーザー名"><br>
    <input id="password" type="password" placeholder="パスワード"><br>
    <button onclick="login()">ログイン</button>
    <p>
      新規登録の方は 
      <a href="#" onclick="showScreen('register-screen')">こちら</a> をクリックしてください。
    </p>
    <p>
      管理者ログインは 
      <a href="#" onclick="showScreen('admin-login-screen')">こちら</a> から。
    </p>
  </div>

  <!-- 新規登録画面 -->
  <div id="register-screen" class="screen">
    <h2>新規登録</h2>
    <input id="new-username" type="text" placeholder="新しいユーザー名"><br>
    <input id="new-password" type="password" placeholder="新しいパスワード"><br>
    <button onclick="register()">登録</button>
    <button onclick="showScreen('login-screen')">戻る</button>
  </div>

  <!-- 管理者ログイン画面 -->
  <div id="admin-login-screen" class="screen">
    <h2>管理者ログイン</h2>
    <input id="admin-username" type="text" placeholder="管理者ID"><br>
    <input id="admin-password" type="password" placeholder="管理者パスワード"><br>
    <button onclick="adminLogin()">ログイン</button>
    <button onclick="showScreen('login-screen')">戻る</button>
    <p style="font-size:small; color:gray; margin-top:10px;">
      ※管理者ログイン用ID: <strong>Admin</strong> / パスワード: <strong>Password0924</strong>
    </p>
  </div>

  <!-- ホーム画面（ゲーム一覧） -->
  <div id="home-screen" class="screen">
    <h1>ゲーム一覧</h1>
    <div class="game-list">
      <!-- 15パズルの項目 -->
      <div class="game-item game-15puzzle">
        <div class="game-title">15パズル</div>
        <div class="game-difficulty">
          <button onclick="startGame(3)">Easy (3×3)</button>
          <button onclick="startGame(4)">Normal (4×4)</button>
          <button onclick="startGame(5)">Hard (5×5)</button>
        </div>
      </div>
      <!-- ○○ゲームの項目（仮）：UNDER CONSTRUCTION 表示 -->
      <div class="game-item game-xx">
        <div class="game-title">○○ゲーム</div>
        <div class="under-construction">UNDER CONSTRUCTION</div>
      </div>
      <!-- △△ゲームの項目（仮）：UNDER CONSTRUCTION 表示 -->
      <div class="game-item game-△△">
        <div class="game-title">△△ゲーム</div>
        <div class="under-construction">UNDER CONSTRUCTION</div>
      </div>
    </div>
    <button class="logout-btn" onclick="logout()">ログアウト</button>
  </div>

  <!-- ゲーム画面（15パズル用） -->
  <div id="game-screen" class="screen">
    <div id="puzzle" class="grid"></div>
    <div id="timer" class="timer">経過時間: 00:00</div>
    <button id="start-btn" onclick="startGameTimer()">スタート</button>
    <button id="retry-btn" onclick="retry()" style="display: none;">リトライ</button>
    <button onclick="goToHome()">ホームに戻る</button>
  </div>

  <!-- ユーザー管理画面 -->
  <div id="admin-screen" class="screen">
    <h2>ユーザー管理画面</h2>
    <ul id="user-list"></ul>
    <button onclick="showScreen('login-screen')">ホームに戻る</button>
  </div>

  <script>
    // ----- 盤面生成（解ける状態のチェック・調整）用の関数群 -----
    function getInversionCount(arr) {
      let inversions = 0;
      const nums = arr.filter(x => x !== null);
      for (let i = 0; i < nums.length; i++) {
        for (let j = i + 1; j < nums.length; j++) {
          if (nums[i] > nums[j]) inversions++;
        }
      }
      return inversions;
    }
    function getBlankRowFromTop(arr, gridSize) {
      const blankIndex = arr.indexOf(null);
      return Math.floor(blankIndex / gridSize) + 1;
    }
    function isSolvable(arr, gridSize) {
      const inversions = getInversionCount(arr);
      if (gridSize % 2 === 1) {
        return inversions % 2 === 0;
      } else {
        const blankRow = getBlankRowFromTop(arr, gridSize);
        return (inversions + blankRow) % 2 === 0;
      }
    }
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }
    function generateSolvablePuzzle(gridSize) {
      let arr = [];
      for (let i = 1; i < gridSize * gridSize; i++) {
        arr.push(i);
      }
      arr.push(null);
      arr = shuffle(arr);
      if (!isSolvable(arr, gridSize)) {
        let idx1 = arr.findIndex(x => x !== null);
        let idx2 = arr.findIndex((x, i) => x !== null && i !== idx1);
        [arr[idx1], arr[idx2]] = [arr[idx2], arr[idx1]];
      }
      return arr;
    }

    // ----- 画面切替、ログインなどの処理 -----
    const screens = document.querySelectorAll(".screen");
    function showScreen(screenId) {
      screens.forEach(screen => screen.classList.remove("visible"));
      document.getElementById(screenId).classList.add("visible");
    }
    let users = {};
    let currentUser = null;
    const adminCredentials = { username: "Admin", password: "Password0924" };
    function login() {
      const username = document.getElementById("username").value;
      const password = document.getElementById("password").value;
      if (users[username] && users[username] === password) {
        currentUser = username;
        alert(`${username}さん、ようこそ！`);
        showScreen("home-screen");
      } else {
        alert("ユーザー名またはパスワードが間違っています。");
      }
    }
    function register() {
      const newUsername = document.getElementById("new-username").value;
      const newPassword = document.getElementById("new-password").value;
      if (!users[newUsername]) {
        users[newUsername] = newPassword;
        alert("登録が完了しました！");
        showScreen("login-screen");
      } else {
        alert("このユーザー名は既に使用されています。");
      }
    }
    function adminLogin() {
      const adminUsername = document.getElementById("admin-username").value;
      const adminPassword = document.getElementById("admin-password").value;
      if (adminUsername === adminCredentials.username && adminPassword === adminCredentials.password) {
        showScreen("admin-screen");
        displayUserList();
      } else {
        alert("管理者IDまたはパスワードが間違っています。");
      }
    }
    function displayUserList() {
      const userList = document.getElementById("user-list");
      userList.innerHTML = "";
      for (const username in users) {
        const li = document.createElement("li");
        li.textContent = username;
        userList.appendChild(li);
      }
    }
    function logout() {
      currentUser = null;
      showScreen("login-screen");
    }

    // ----- ゲーム・パズル機能 -----
    let gridSize = 4; // 初期はNormal（4×4）; 3×3なら3、5×5なら5
    let tiles = [];
    let emptyTileIndex;
    let timerInterval, startTime;
    let gameStarted = false;
    function startGame(size) {
      gridSize = size;
      tiles = generateSolvablePuzzle(gridSize);
      renderPuzzle();
      resetTimer();
      showScreen("game-screen");
      document.getElementById("start-btn").style.display = "block";
      gameStarted = false;
    }
    function renderPuzzle() {
      const puzzle = document.getElementById("puzzle");
      puzzle.innerHTML = "";
      puzzle.style.gridTemplateColumns = `repeat(${gridSize}, 100px)`;
      puzzle.style.gridTemplateRows = `repeat(${gridSize}, 100px)`;
      tiles.forEach((tile, index) => {
        const tileElement = document.createElement("div");
        tileElement.className = "tile";
        tileElement.textContent = tile !== null ? tile : "";
        if (tile === null) {
          tileElement.classList.add("empty");
          emptyTileIndex = index;
        }
        tileElement.addEventListener("click", () => {
          if (!gameStarted) return;
          moveTile(index);
        });
        puzzle.appendChild(tileElement);
      });
    }
    function moveTile(index) {
      if (!gameStarted) return;
      const row = Math.floor(index / gridSize);
      const col = index % gridSize;
      const emptyRow = Math.floor(emptyTileIndex / gridSize);
      const emptyCol = emptyTileIndex % gridSize;
      if ((Math.abs(row - emptyRow) + Math.abs(col - emptyCol)) === 1) {
        [tiles[index], tiles[emptyTileIndex]] = [tiles[emptyTileIndex], tiles[index]];
        emptyTileIndex = index;
        renderPuzzle();
        if (isSolved()) endGame();
      }
    }
    function isSolved() {
      for (let i = 0; i < tiles.length - 1; i++) {
        if (tiles[i] !== i + 1) return false;
      }
      return true;
    }
    function endGame() {
      clearInterval(timerInterval);
      const finalTime = document.getElementById("timer").textContent;
      renderPuzzle();
      document.getElementById("retry-btn").style.display = "block";
      alert(`おめでとうございます！クリアタイム: ${finalTime}`);
    }
    function retry() {
      tiles = generateSolvablePuzzle(gridSize);
      renderPuzzle();
      resetTimer();
      gameStarted = false;
      document.getElementById("start-btn").style.display = "block";
    }
    function resetTimer() {
      clearInterval(timerInterval);
      startTime = Date.now();
      document.getElementById("timer").textContent = "経過時間: 00:00";
    }
    function startGameTimer() {
      startTime = Date.now();
      timerInterval = setInterval(() => {
        const elapsedTime = Date.now() - startTime;
        const minutes = String(Math.floor(elapsedTime / 60000)).padStart(2, "0");
        const seconds = String(Math.floor((elapsedTime % 60000) / 1000)).padStart(2, "0");
        document.getElementById("timer").textContent = `経過時間: ${minutes}:${seconds}`;
      }, 1000);
      gameStarted = true;
      document.getElementById("start-btn").style.display = "none";
    }
    function goToHome() {
      clearInterval(timerInterval);
      showScreen("home-screen");
    }
  </script>

  <div class="author">This Puzzle Game was developed with the support of ChatGPT.</div>
</body>
</html>
