<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>簡易Webアプリ</title>
    <style>
        /* 基本スタイル */
        .screen {
            display: none;
            text-align: center;
            font-family: Arial, sans-serif;
        }
        .visible {
            display: block;
        }
        h1 {
            color: #2196F3;
        }
        input {
            margin: 10px;
            padding: 10px;
            font-size: 1em;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            padding: 10px 20px;
            font-size: 1.2em;
            cursor: pointer;
            background-color: #2196F3;
            color: white;
            border: none;
            border-radius: 5px;
            margin-top: 10px;
        }
        .author {
            font-size: 0.9em;
            margin-top: 20px;
            color: #555;
        }
        .grid {
            display: grid;
            gap: 5px;
            justify-content: center;
        }
        .tile {
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2em;
            background-color: #4CAF50;
            color: white;
            cursor: pointer;
            width: 100px;
            height: 100px;
        }
        .empty {
            background-color: #ddd;
            cursor: default;
        }
        .timer {
            font-size: 1.5em;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>

    <!-- ログイン画面 -->
    <div id="login-screen" class="screen visible">
        <h1>ログイン画面</h1>
        <input type="text" id="login-username" placeholder="ユーザー名">
        <input type="password" id="login-password" placeholder="パスワード">
        <button onclick="login()">ログイン</button>
        <p id="login-error-msg" style="color: red;"></p>
        <p>
            <a href="#" onclick="showScreen('register-screen')">新規登録はこちら</a> |
            <a href="#" onclick="showScreen('admin-login-screen')">管理者ログインはこちら</a>
        </p>
    </div>

    <!-- 新規登録画面 -->
    <div id="register-screen" class="screen">
        <h1>新規登録画面</h1>
        <input type="text" id="register-username" placeholder="新しいユーザー名">
        <input type="password" id="register-password" placeholder="新しいパスワード">
        <button onclick="register()">登録</button>
        <p id="register-msg" style="color: green;"></p>
        <p>
            <a href="#" onclick="showScreen('login-screen')">ログイン画面へ</a> |
            <a href="#" onclick="showScreen('login-screen')">既にアカウントがある方はこちら</a>
        </p>
    </div>

    <!-- 管理者ログイン画面 -->
    <div id="admin-login-screen" class="screen">
        <h1>管理者ログイン画面</h1>
        <input type="text" id="admin-username" placeholder="管理者ユーザー名">
        <input type="password" id="admin-password" placeholder="管理者パスワード">
        <button onclick="adminLogin()">ログイン</button>
        <p id="admin-error-msg" style="color: red;"></p>
        <p><a href="#" onclick="showScreen('login-screen')">ログイン画面はこちら</a></p>
    </div>

    <!-- 管理者ホーム画面 -->
    <div id="admin-home-screen" class="screen">
        <h1>管理者ホーム画面</h1>
        <h2>登録ユーザー一覧</h2>
        <ul id="user-list"></ul>
        <button onclick="logout()">ログアウト</button>
    </div>

    <!-- ホーム画面 -->
    <div id="home-screen" class="screen">
        <h1>15パズルへようこそ！</h1>
        <p>難易度を選んでください:</p>
        <button onclick="startGame(3)">Easy (3×3)</button>
        <button onclick="startGame(4)">Normal (4×4)</button>
        <button onclick="startGame(5)">Hard (5×5)</button>
        <button onclick="logout()">ログアウト</button>
        <div class="author">
            This "15 Puzzle Game" was developed with the support of ChatGPT.
        </div>
    </div>

    <!-- ゲーム画面 -->
    <div id="game-screen" class="screen">
        <div class="timer" id="timer">経過時間: 00:00</div>
        <div class="grid" id="puzzle"></div>
        <button onclick="retry()">再挑戦</button>
        <button onclick="goToHome()">ホームへ戻る</button>
    </div>

    <script>
        const storedAdminUsername = "admin";
        const storedAdminPassword = "admin123";
        let users = JSON.parse(localStorage.getItem("users")) || [];

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => screen.classList.remove('visible'));
            document.getElementById(screenId).classList.add('visible');
        }

        function register() {
            const username = document.getElementById("register-username").value;
            const password = document.getElementById("register-password").value;
            if (username && password && !users.find(user => user.username === username)) {
                users.push({ username, password });
                localStorage.setItem("users", JSON.stringify(users));
                document.getElementById("register-msg").textContent = "登録が成功しました";
            } else {
                document.getElementById("register-msg").textContent = "登録失敗：既に存在するユーザー名です";
            }
        }

        function login() {
            const username = document.getElementById("login-username").value;
            const password = document.getElementById("login-password").value;
            const user = users.find(user => user.username === username && user.password === password);
            if (user) {
                localStorage.setItem("isLoggedIn", "true");
                showScreen("home-screen");
            } else {
                document.getElementById("login-error-msg").textContent = "ユーザー名またはパスワードが違います";
            }
        }

        function adminLogin() {
            const username = document.getElementById("admin-username").value;
            const password = document.getElementById("admin-password").value;
            if (username === storedAdminUsername && password === storedAdminPassword) {
                showScreen("admin-home-screen");
                showAdminScreen();
            } else {
                document.getElementById("admin-error-msg").textContent = "IDまたはパスワードが間違っています";
            }
        }

        function showAdminScreen() {
            const userListElement = document.getElementById("user-list");
            userListElement.innerHTML = "";
            users.forEach(user => {
                const userItem = document.createElement("li");
                userItem.textContent = `ID: ${user.username}, Password: ${user.password}`;
                userListElement.appendChild(userItem);
            });
        }

        function logout() {
            localStorage.removeItem("isLoggedIn");
            showScreen("login-screen");
        }

        function startGame(size) {
            document.getElementById("puzzle").style.gridTemplateColumns = `repeat(${size}, 1fr)`;
            document.getElementById("puzzle").style.gridTemplateRows = `repeat(${size}, 1fr)`;
            createTiles(size);
            resetTimer();
            startTimer();
            showScreen("game-screen");
        }

        function createTiles(size) {
            const puzzle = document.getElementById("puzzle");
            const tileCount = size * size - 1;
            const numbers = Array.from({ length: tileCount }, (_, i) => i + 1);
            numbers.push(null);
            numbers.sort(() => Math.random() - 0.5);

            puzzle.innerHTML = '';
            numbers.forEach(number => {
                const tile = document.createElement('div');
                tile.className = number ? 'tile' : 'tile empty';
                tile.textContent = number || '';
                tile.onclick = () => moveTile(tile, size);
                puzzle.appendChild(tile);
            });
        }

        function moveTile(tile, size) {
            const emptyTile = document.querySelector('.tile.empty');
            const tileIndex = Array.from(document.getElementById("puzzle").children).indexOf(tile);
            const emptyIndex = Array.from(document.getElementById("puzzle").children).indexOf(emptyTile);

            const rowDiff = Math.abs(Math.floor(tileIndex / size) - Math.floor(emptyIndex / size));
            const colDiff = Math.abs((tileIndex % size) - (emptyIndex % size));
            if (rowDiff + colDiff === 1) {
                [tile.textContent, emptyTile.textContent] = [emptyTile.textContent, tile.textContent];
                tile.classList.toggle('empty');
                emptyTile.classList.toggle('empty');
                checkCompletion(size);
            }
        }

        function checkCompletion(size) {
            const tiles = Array.from(document.getElementById("puzzle").children);
            const isCompleted = tiles.slice(0, -1).every((tile, i) => tile.textContent == i + 1);
            if (isCompleted) {
                stopTimer();
                alert(`おめでとうございます！クリアしました！時間: ${document.getElementById("timer").textContent}`);
            }
        }

        let timerInterval, startTime;
        function startTimer() {
            startTime = Date.now();
            timerInterval = setInterval(() => {
                const elapsedTime = Date.now() - startTime;
                const minutes = Math.floor(elapsedTime / 60000).toString().padStart(2, '0');
                const seconds = Math.floor((elapsedTime % 60000) / 1000).toString().padStart(2, '0');
                document.getElementById("timer").textContent = `経過時間: ${minutes}:${seconds}`;
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        function resetTimer() {
            if (timerInterval) clearInterval(timerInterval);
            document.getElementById("timer").textContent = '経過時間: 00:00';
        }

        function retry() {
            startGame(gridSize);
        }

        function goToHome() {
            stopTimer();
            showScreen("home-screen");
        }

        // ページ読み込み時の初期化処理
        window.onload = function() {
            const isLoggedIn = localStorage.getItem("isLoggedIn") === "true";
            if (isLoggedIn) {
                showScreen("home-screen");
            } else {
                showScreen("login-screen");
            }
        };
    </script>

</body>
</html>
